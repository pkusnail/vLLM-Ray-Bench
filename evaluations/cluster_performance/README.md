# 集群性能测试

## ⚡ 测试目标

专注评估vLLM集群的**系统性能指标**，忽略回答内容质量。

## 📊 测试维度

### 1. 延迟指标
- **平均响应时间**: 所有请求的平均处理时间
- **P95延迟**: 95%的请求在此时间内完成
- **P99延迟**: 99%的请求在此时间内完成
- **最小/最大延迟**: 延迟范围分析

### 2. 吞吐量指标
- **请求吞吐量**: 每秒处理的请求数 (req/s)
- **Token吞吐量**: 每秒处理的Token数 (tok/s)
- **并发扩展性**: 不同并发下的吞吐量变化

### 3. 可靠性指标
- **成功率**: 请求成功处理的百分比
- **稳定性**: 长时间运行的性能稳定性
- **错误率**: 系统错误和超时情况

### 4. 资源效率
- **集群效率**: 每个并发每秒处理的请求数
- **GPU利用率**: 16个GPU的整体利用效率
- **扩展线性度**: 并发增加时的性能提升比例

## 🧪 测试场景

| 场景名称 | 并发数 | 总请求数 | 测试目标 |
|---------|-------|----------|----------|
| 基线延迟 | 1 | 10 | 单请求基准性能 |
| 低并发 | 2 | 20 | 低负载稳定性 |
| 中并发 | 5 | 50 | 中等负载性能 |
| 高并发 | 10 | 100 | 高负载压力测试 |
| 极限并发 | 20 | 200 | 系统极限能力 |
| 持久性能 | 8 | 160 | 长时间稳定性 |
| 突发流量 | 15 | 75 | 流量峰值处理 |

## 🚀 使用方法

```bash
cd evaluation/cluster_performance  
python cluster_performance_test.py
```

## 📈 性能等级

- **🌟 卓越** (>500 tok/s): 高性能集群
- **✅ 优秀** (300-500 tok/s): 生产级性能
- **⚠️ 良好** (150-300 tok/s): 基本满足需求
- **❌ 待优化** (<150 tok/s): 性能不足

## 🏗️ 测试架构

- **集群配置**: PP=2, TP=8 (2 nodes, 16 GPUs)
- **模型**: Qwen/Qwen3-32B
- **测试方式**: 固定短回答，专注系统性能
- **测试提示**: 统一使用简单问题避免内容复杂度影响

## 📁 输出文件

- `cluster_performance_evaluation.json`: 详细性能指标和原始数据